---
title: 背景知识
layout: /src/layouts/autonum.astro
---

# Arch Linux 启动流程

这里以目前最常见的 UEFI、GPT、GRUB 与 amd64 的组合为例，以通俗（但不严谨）的语言，简单概括一下启动流程（详细资料参见 [ArchWiki](https://wiki.archlinuxcn.org/wiki/Arch_boot_process)）。

先用一句话总括：
先启动主板（UEFI），再（通过 esp 来）启动 GRUB，最后启动 Linux 内核。

1. **主板：** 当你按下开机键时，电脑的主板收到开机信号，于是让电源工作起来，再做一些自我检查，最后启动自身附带的 UEFI。
2. **UEFI：** UEFI 会识别显示屏、鼠标、硬盘等硬件，并让它们可以工作，再扫描各个硬盘上的 EFI 分区（即 esp），启动其中的 `/EFI/GRUB/grubx64.efi` 文件，即 GRUB 的 EFI 二进制文件。
3. **GRUB(EFI)：** GRUB 的 EFI 二进制文件并不是完全体，而是只能按照设定好的程序，用指定方法，在指定的文件系统中找到自己的本体并且运行本体。
   - 原因：由于 esp 严格限定文件系统，并且 EFI 二进制文件格式本身也能力有限，想要在这里放下一个完整的引导程序（比如 EFISTUB）不是不行，但功能上就较为简陋了。所以，一般都是在此处放一个“传送门”来启动更强大的本体，GRUB 就属于这种情况。
   - 注：之后在 Linux 运行期间，一般会把 GRUB 本体所在的这个文件系统挂载到 `/boot` ，所以我们一般把它叫作 boot 分区；但是请你明白，在 GRUB 运行期间，连 Linux 的 `/` 都没有出现，当然也并不存在 `/boot` 。
4. **GRUB(BOOT)：** 现在，你启动了 boot 分区中的 GRUB 的本体——它是目前最强大的启动引导器（Bootloader），足以完成很多目标。于是你使用它选择了某个启动条目（通常是第一个），它根据条目信息，找到并加载了 Linux 内核（通常与 GRUB 放在一起，也在 `/boot` 里面）。
5. **Linux 内核：** Linux 内核启动。它虚拟出了一个“目录树”，根据 GRUB 提供的信息，把指定的文件系统挂载到根目录 `/` 上。然后，再根据 `/etc/fstab` 的信息，把指定的其他文件系统挂载到指定位置（比如它可以把 esp 挂载到 `/boot/efi` 或者 `/efi` ）。
   - 注：即使不挂载 esp 也不会影响 Linux 的运行，但在安装与升级 GRUB 时这是必须的；至于 `/boot` 则通常是 Linux 内核及部分模块的所在，所以是必须挂载的（除非它与 `/` 是同一文件系统）。
6. **Linux：** 之后会启动 Getty，Getty 可能会启动登录管理器（即 LM 或 DM），也可能启动 tty，供用户登录。如果桌面环境已经安装好，它将在这之后启动。
